[mlimg]
[xlang:en]
== FCKeditor for XOOPS ==

[b]USAGE[/b]
- extract file tree under XOOPS_ROOT_PATH  (XOOPS_ROOT_PATH/common/)
- make directory named fckeditor under uploads (XOOPS_ROOT_PATH/uploads/fckeditor/)
- set permission of the directory 0777 (if your PHP runs as CGI, set 0755 instead)
- to modify configuration, rename  editor/filemanager/browser/default/connectors/phpconfig_and_auth.inc.dist.php to phpconfig_and_auth.inc.php. then edit the file.


[b]DIFF[/b]

- file tree
all of connectors or uploaders other than php are removed.
and php connector and uploader have been modified radically. (for preventing fatal vulnerability)

- the file name stored in the server is independent from local file name

- abondon directories per resource types
in this version, resource type means the extraction from files

- consider safe_mode
if you want to create folder under safe_mode, you have to make the directory manually via FTP etc.

- permission of browsing and uploading
only admin of XOOPS can use browser and uploader with default phpconfig_and_auth.inc.php

- uploading by normal users
If you want to allow normal users can upload image files, modify $fck_uploadable_groups in phpconfig_and_auth.inc.php
A normal user can browse only files uploaded by him/herself.
A normal user cannot create a new folder.

- resize original/making thumnail
If you want special action about uploaded files, modify phpconfig_and_auth.inc.php as you like.
A function fck_resize_by_imagemagick() will be a good sample.
(Resizing original image files inside 480x480 box by ImageMagick Package)


[/xlang:en]
[xlang:ja]
== XOOPS用 FCKeditor ==

●利用法

アーカイブを解凍し、XOOPS_ROOT_PATH直下においてください。
XOOPS_ROOT_PATH/common/
という形になります。

すでに、なんらかのcommonファイルを入れていれば、commonフォルダがある
はずですし、なければ新しくcommonフォルダを作る形になります。

ファイルアップロードを利用するためには、XOOPS_ROOT_PATH/uploads の下に、fckeditor というフォルダをFTP等で作ってください。このフォルダのパーミッションは場合に応じて異なりますが、phpがApacheモジュールとして動いているなら777、CGI版なら755です。

アプリケーションからの利用法ですが、FCKeditorの本来の使い方でOKです。
HTML+JavaScriptとして用意するだけです。

XOOPSモジュールでは、とりあえずpicoが対応しています。

fckxoopsの設定は、一応、editor/filemanager/browser/default/connectors/phpconfig_and_auth.inc.dist.php にまとまっています。これをカスタマイズする際には、phpconfig_and_auth.inc.php にリネームしてから編集すると、今後のバージョンアップで上書きされることはなくなるでしょう。


●オリジナルとの相違

・アーカイブ構成
php以外のコネクタ・アップローダはすべて削除してます。
また、オリジナルのphpのコネクタ・アップローダには大きな脆弱性があり、他にもいろいろ問題があったため、ほぼまるまる書き直してます。

・ファイル名の非保存
アップロードする際に、ローカルのファイル名は維持しません。
新しくファイル名が作成されます。
一応、判りやすくするために、日付をファイル名に含めています。

・リソースタイプ毎のディレクトリの振り分け機能削除
この振り分けは使いづらくなるだけで、意味がないと思われたため、その機能をバッサリ削除してます。「絞り込み」であれば意味があるので、一応実装してます。

・safe_mode対応
safe_mode制限でハマることを避けるため、safe_modeの場合は、ディレクトリを作ることが出来ないようにしています。
safe_modeサーバの場合は、FTP等でuploads/fckeditor/の下に、適宜フォルダを作成してください。

・アップロード権限
オリジナルではいずれも無制限にできる仕様だったのですが、この版では、XOOPSにログインしていて、かつ、特定の権限がなければ利用できません。そのあたりの権限振り分けは、phpconfig_and_auth.inc.php の書き方一つです。
デフォルトでは、いわゆる「管理者」にしか、アップロードを許可していません。この「管理者」とは、システムモジュールの管理者（X2用）か、legacyモジュールの管理者(Cube 2.1用)のいずれかを意味します。

・ノーマルユーザのアップロード権限
phpconfig_and_auth.inc.php で $fck_uploadable_groups の設定を変更すれば、管理者ではない通常のユーザもアップロードができるようになります。この場合、自分がアップロードしたファイル以外は、サーバーブラウザで見ることが出来ません。フォルダによる振り分けではなく、ファイルprefixによる振り分けです。なお、ノーマルユーザはフォルダの作成権限もありません。

・アップロードされた画像のリサイズ/サムネイル作成
これも、phpconfig_and_auth.inc.php の書き方一つで、どのようにでもできます。fck_resize_by_imagemagick() を参考にしてください。（ImageMagickを使って、480x480というボックス内に納める処理を行う）


●TODO
・ブラウズ権限/アップロード権限の細かな実装
・画像の自動サムネール作成（リンクと画像の両方に自動入力されるように…）
・Attachmanモジュールとの連携
・XOOPS_TRUST_PATH側に保存する機能（もちろん転送スクリプトも）


●FCKeditor のcommon化作業記録
(2006-12-14) 2.3.2-001
- FCKeditor 最新版のダウンロード/解凍
- FCKeditor/直下から、editor/ *.js *.xml *.txt 以外をすべて削除
- editor/filemanager/browser/default/connectors/ のphp以外のディレクトリをすべて削除 (test.htmlも)
- editor/filemanager/upload/ のphp以外のディレクトリをすべて削除 (text.htmlも)
- fckconfig.js の編集
var _FileBrowserLanguage	= 'php' ; // オリジナルはasp
var _QuickUploadLanguage	= 'php' ; // オリジナルはasp
- editor/filemanager/browser/default/connectors/php/ 直下のPHPファイルをまるまる作り直し
- editor/filemanager/upload/php/ 直下のPHPファイルをまるまる作り直し
- uploadとbrowseが両方とも同じconfigを利用できるように
(2007-09-14) 2.3.2-002
- editor/filemanager/browser/default/frmresourceslist.html をいじって画像なら画像そのものを表示するようにHackした
- リサイズなどの処理を追加できるようにした
- ノーマル権限の設定を可能とした
- フォルダ作成は管理者だけができるようにした
- ノーマル権限では自分がアップしたファイルだけがブラウズできるようにした
(2007-11-18) 2.3.2-003
- アップロードしたファイルのパーミッションを644に変更するコードの追加

[/xlang:ja]
